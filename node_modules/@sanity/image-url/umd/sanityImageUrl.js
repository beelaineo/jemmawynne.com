(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.SanityImageUrlBuilder = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
module.exports=require("./lib/builder").default;

},{"./lib/builder":2}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=urlBuilder;var _urlForImage=_interopRequireDefault(require("./urlForImage"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){_defineProperty(t,e,i[e])})}return t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var validFits=["clip","crop","fill","fillmax","max","scale","min"],validCrops=["top","bottom","left","right","center","focalpoint","entropy"],validAutoModes=["format"],ImageUrlBuilder=function(){function t(e,i){_classCallCheck(this,t),this.options=e?_objectSpread({},e.options||{},i||{}):i||{}}return _createClass(t,[{key:"withOptions",value:function(e){return new t(this,e)}},{key:"image",value:function(t){return this.withOptions({source:t})}},{key:"dataset",value:function(t){return this.withOptions({dataset:t})}},{key:"projectId",value:function(t){return this.withOptions({projectId:t})}},{key:"bg",value:function(t){return this.withOptions({bg:t})}},{key:"width",value:function(t){return this.withOptions({width:t})}},{key:"height",value:function(t){return this.withOptions({height:t})}},{key:"focalPoint",value:function(t,e){return this.withOptions({focalPoint:{x:t,y:e}})}},{key:"maxWidth",value:function(t){return this.withOptions({maxWidth:t})}},{key:"minWidth",value:function(t){return this.withOptions({minWidth:t})}},{key:"maxHeight",value:function(t){return this.withOptions({maxHeight:t})}},{key:"minHeight",value:function(t){return this.withOptions({minHeight:t})}},{key:"size",value:function(t,e){return this.withOptions({width:t,height:e})}},{key:"blur",value:function(t){return this.withOptions({blur:t})}},{key:"sharpen",value:function(t){return this.withOptions({sharpen:t})}},{key:"rect",value:function(t,e,i,n){return this.withOptions({rect:{left:t,top:e,width:i,height:n}})}},{key:"format",value:function(t){return this.withOptions({format:t})}},{key:"invert",value:function(t){return this.withOptions({invert:t})}},{key:"orientation",value:function(t){return this.withOptions({orientation:t})}},{key:"quality",value:function(t){return this.withOptions({quality:t})}},{key:"forceDownload",value:function(t){return this.withOptions({download:t})}},{key:"flipHorizontal",value:function(){return this.withOptions({flipHorizontal:!0})}},{key:"flipVertical",value:function(){return this.withOptions({flipVertical:!0})}},{key:"ignoreImageParams",value:function(){return this.withOptions({ignoreImageParams:!0})}},{key:"fit",value:function(t){if(-1===validFits.indexOf(t))throw new Error('Invalid fit mode "'.concat(t,'"'));return this.withOptions({fit:t})}},{key:"crop",value:function(t){if(-1===validCrops.indexOf(t))throw new Error('Invalid crop mode "'.concat(t,'"'));return this.withOptions({crop:t})}},{key:"auto",value:function(t){if(-1===validAutoModes.indexOf(t))throw new Error('Invalid auto mode "'.concat(t,'"'));return this.withOptions({auto:t})}},{key:"url",value:function(){return(0,_urlForImage.default)(this.options)}},{key:"toString",value:function(){return this.url()}}]),t}();function urlBuilder(t){return t&&"object"===_typeof(t.clientConfig)?new ImageUrlBuilder(null,{baseUrl:t.clientConfig.apiHost.replace(/^https:\/\/api\./,"https://cdn."),projectId:t.clientConfig.projectId,dataset:t.clientConfig.dataset}):new ImageUrlBuilder(null,t)}

},{"./urlForImage":5}],3:[function(require,module,exports){
"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){var t=[],a=!0,i=!1,n=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done)&&(t.push(o.value),!r||t.length!==r);a=!0);}catch(e){i=!0,n=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw n}}return t}function _arrayWithHoles(e){if(Array.isArray(e))return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=parseAssetId;var example="image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg";function parseAssetId(e){var r=_slicedToArray(e.split("-"),4),t=r[1],a=r[2],i=r[3];if(!t||!a||!i)throw new Error("Malformed asset _ref '".concat(e,"'. Expected an id like \"").concat(example,'".'));var n=_slicedToArray(a.split("x"),2),o=+n[0],l=+n[1];if(!(isFinite(o)&&isFinite(l)))throw new Error("Malformed asset _ref '".concat(e,"'. Expected an id like \"").concat(example,'".'));return{id:t,width:o,height:l,format:i}}

},{}],4:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function parseSource(t){if(!t)return null;var e;if("string"==typeof t&&isUrl(t))e={asset:{_ref:urlToId(t)}};else if("string"==typeof t)e={asset:{_ref:t}};else if("string"==typeof t._ref)e={asset:t};else if(t._id)e={asset:{_ref:t._id}};else if(t.asset&&t.asset.url&&!t.asset._ref)e={asset:{_ref:urlToId(t.asset.url)}};else{if("object"!==_typeof(t.asset))return null;e=t}return t.crop&&(e.crop=t.crop),t.hotspot&&(e.hotspot=t.hotspot),applyDefaults(e)}function isUrl(t){return/^https?:\/\//.test("".concat(t))}function urlToId(t){var e=t.split("/").slice(-1);return"image-".concat(e[0]).replace(/\.([a-z]+)$/,"-$1")}function applyDefaults(t){if(t.crop&&t.hotspot)return t;var e=Object.assign({},t);return e.crop||(e.crop={left:0,top:0,bottom:0,right:0}),e.hotspot||(e.hotspot={x:.5,y:.5,height:1,width:1}),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=parseSource;

},{}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=urlForImage,Object.defineProperty(exports,"parseSource",{enumerable:!0,get:function(){return _parseSource.default}});var _parseSource=_interopRequireDefault(require("./parseSource")),_parseAssetId=_interopRequireDefault(require("./parseAssetId"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){var r=[],o=!0,a=!1,i=void 0;try{for(var n,c=t[Symbol.iterator]();!(o=(n=c.next()).done)&&(r.push(n.value),!e||r.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{o||null==c.return||c.return()}finally{if(a)throw i}}return r}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),o.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var SPEC_NAME_TO_URL_NAME_MAPPINGS=[["width","w"],["height","h"],["format","fm"],["download","dl"],["blur","blur"],["sharpen","sharp"],["invert","invert"],["orientation","or"],["minHeight","min-h"],["maxHeight","max-h"],["minWidth","min-w"],["maxWidth","max-w"],["quality","q"],["fit","fit"],["crop","crop"],["auto","auto"]];function urlForImage(t){var e=_objectSpread({},t||{}),r=e.source;delete e.source;var o=(0,_parseSource.default)(r);if(!o)return null;var a=(0,_parseAssetId.default)(o.asset._ref||o.asset._id),i={left:Math.round(o.crop.left*a.width),top:Math.round(o.crop.top*a.height)};i.width=Math.round(a.width-o.crop.right*a.width-i.left),i.height=Math.round(a.height-o.crop.bottom*a.height-i.top);var n=o.hotspot.height*a.height/2,c=o.hotspot.width*a.width/2,h=o.hotspot.x*a.width,u=o.hotspot.y*a.height,l={left:h-c,top:u-n,right:h+c,bottom:u+n};return e.asset=a,e.rect||e.focalPoint||e.ignoreImageParams||e.crop||(e=_objectSpread({},e,fit({crop:i,hotspot:l},e))),specToImageUrl(e)}function specToImageUrl(t){var e=t.baseUrl||"https://cdn.sanity.io",r="".concat(t.asset.id,"-").concat(t.asset.width,"x").concat(t.asset.height,".").concat(t.asset.format),o="".concat(e,"/images/").concat(t.projectId,"/").concat(t.dataset,"/").concat(r),a=[];t.rect&&((0!=t.rect.left||0!=t.rect.top||t.rect.height!=t.asset.height||t.rect.width!=t.asset.width)&&a.push("rect=".concat(t.rect.left,",").concat(t.rect.top,",").concat(t.rect.width,",").concat(t.rect.height)));return t.bg&&a.push("bg=".concat(t.bg)),t.focalPoint&&(a.push("fp-x=".concat(t.focalPoint.x)),a.push("fp-x=".concat(t.focalPoint.y))),(t.flipHorizontal||t.flipVertical)&&a.push("flip=".concat(t.flipHorizontal?"h":"").concat(t.flipVertical?"v":"")),SPEC_NAME_TO_URL_NAME_MAPPINGS.forEach(function(e){var r=_slicedToArray(e,2),o=r[0],i=r[1];void 0!==t[o]?a.push("".concat(i,"=").concat(encodeURIComponent(t[o]))):void 0!==t[i]&&a.push("".concat(i,"=").concat(encodeURIComponent(t[i])))}),0===a.length?o:"".concat(o,"?").concat(a.join("&"))}function fit(t,e){var r={width:e.width,height:e.height};if(!e.width||!e.height)return r.rect=t.crop,r;var o=t.crop,a=t.hotspot,i=e.width/e.height;if(o.width/o.height>i){var n=o.height,c=n*i,h=o.top,u=(a.right-a.left)/2+a.left-c/2;return u<o.left?u=o.left:u+c>o.left+o.width&&(u=o.left+o.width-c),r.rect={left:Math.round(u),top:Math.round(h),width:Math.round(c),height:Math.round(n)},r}var l=o.width,p=l/i,f=o.left,s=(a.bottom-a.top)/2+a.top-p/2;return s<o.top?s=o.top:s+p>o.top+o.height&&(s=o.top+o.height-p),r.rect={left:Math.max(0,Math.floor(f)),top:Math.max(0,Math.floor(s)),width:Math.round(l),height:Math.round(p)},r}

},{"./parseAssetId":3,"./parseSource":4}]},{},[1])(1)
});
