"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = ExpandToWordPlugin;

// This plugin expands the selection to the focused word
function ExpandToWordPlugin() {
  return {
    // eslint-disable-next-line complexity
    onCommand(command, editor, next) {
      if (command.type !== 'expandToWord') {
        return next();
      }

      var _editor$value = editor.value,
          focusText = _editor$value.focusText,
          selection = _editor$value.selection;

      if (!selection.isExpanded) {
        var focus = selection.focus;
        var focusOffset = focus.offset;
        var charsBefore = focusText.text.slice(0, focusOffset);
        var charsAfter = focusText.text.slice(focusOffset, -1);

        var isEmpty = str => str.match(/\s/g);

        var whiteSpaceBeforeIndex = charsBefore.split('').reverse().findIndex(str => isEmpty(str));
        var newStartOffset = whiteSpaceBeforeIndex > -1 ? charsBefore.length - whiteSpaceBeforeIndex : -1;
        var whiteSpaceAfterIndex = charsAfter.split('').findIndex(obj => isEmpty(obj));
        var newEndOffset = charsBefore.length + (whiteSpaceAfterIndex > -1 ? whiteSpaceAfterIndex : charsAfter.length + 1); // Not near any word, abort

        if (newStartOffset === newEndOffset || isNaN(newStartOffset) || isNaN(newEndOffset)) {
          return next();
        } // Select and highlight current word


        return editor.moveAnchorTo(newStartOffset).moveFocusTo(newEndOffset).focus();
      }

      return next();
    }

  };
}