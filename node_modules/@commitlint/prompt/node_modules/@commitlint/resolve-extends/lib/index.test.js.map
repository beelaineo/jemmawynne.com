{"version":3,"sources":["../src/index.test.js"],"names":["sander","id","t","actual","deepEqual","expected","foo","serial","prev","process","env","PREFIX","bootstrap","cwd","prefix","npm","args","mkdir","extends","notThrows","input","throws","resolve","require","is","propagated","push","baz","rules","rule","zero","one","two","three","Error","fallback"],"mappings":";;AAAA;;;;AACA;;;;AACA;;AACA;;IAAYA,M;;AACZ;;;;;;;;AAEA,MAAMC,KAAKA,MAAMA,EAAjB;;AAEA,mBAAK,iDAAL,EAAwDC,KAAK;AAC5D,OAAMC,SAAS,iBAAf;AACAD,GAAEE,SAAF,CAAYD,MAAZ,EAAoB,EAApB;AACA,CAHD;;AAKA,mBAAK,2CAAL,EAAkDD,KAAK;AACtD,OAAMG,WAAW,EAACC,KAAK,KAAN,EAAjB;AACA,OAAMH,SAAS,gBAAeE,QAAf,CAAf;AACAH,GAAEE,SAAF,CAAYD,MAAZ,EAAoBE,QAApB;AACA,CAJD;;AAMA,cAAKE,MAAL,CAAY,8BAAZ,EAAkDL,CAAN;AAAA;AACrCM,KADqC,GAC9BC,QAAQC,GAAR,CAAYC,MADkB;AAG/B,wBAAM,UAAIC,SAAJ,CAAc,yBAAd,CAAN;AAAA;AAANC,MAAM;AACNC,SADM,GACI,GAAED,GAAI,0BADV;AAGNE,MAHM,GAGAC,QAAQ,qBAAM,KAAN,EAAaA,IAAb,EAAmB,EAACH,GAAD,EAAnB,CAHR;AAKZ,0BAAMb,OAAOiB,KAAP,CAAaJ,GAAb,EAAkB,yBAAlB,CAAN;AAAA;;AAEAJ,aAAQC,GAAR,CAAYC,MAAZ,GAAqBG,MAArB;;AAEA,4BAAMC,IAAI,CACT,SADS,EAET,UAFS,EAGT,4BAHS,EAIT,UAJS,EAKTD,MALS,CAAJ,CAAN;AAAA;AAQMT,eARN,GAQiB,EAACa,SAAS,CAAC,4BAAD,CAAV,EARjB;;AASAhB,SAAEiB,SAAF,CAAY,MAAM,gBAAed,QAAf,CAAlB;;AAEAI,eAAQC,GAAR,CAAYC,MAAZ,GAAqBH,IAArB;AAXA;AAAA;AAAA;AAAA;AAAA;AAJA;AAAA;AAAA;AAAA;AALY;AAAA;AAAA;AAAA;AAH+B,aAA5C;;AA0BA,cAAKD,MAAL,CAAY,2BAAZ,EAA+CL,CAAN;AAAA;AAClCM,KADkC,GAC3BC,QAAQC,GAAR,CAAYC,MADe;AAG5B,wBAAM,UAAIC,SAAJ,CAAc,0BAAd,CAAN;AAAA;AAANC,MAAM;AACNC,SADM,GACI,GAAED,GAAI,0BADV;;;AAGZJ,WAAQC,GAAR,CAAYC,MAAZ,GAAqBG,MAArB;;AAEMM,QALM,GAKE,EAACF,SAAS,CAAC,qBAAD,CAAV,EALF;;;AAOZhB,KAAEmB,MAAF,CACC,MAAM,gBAAeD,KAAf,EAAsB,EAACP,GAAD,EAAtB,CADP,EAEC,gDAFD;;AAKAJ,WAAQC,GAAR,CAAYC,MAAZ,GAAqBH,IAArB;AAZY;AAAA;AAAA;AAAA;AAAA;AAH4B,aAAzC;;AAkBA,mBAAK,8BAAL,EAAqCN,KAAK;AACzC,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;;AAEA,iBAAeE,KAAf,EAAsB;AACrBE,WAASrB,EADY;AAErBsB,UAAQtB,EAAR,EAAY;AACXC,KAAEsB,EAAF,CAAKvB,EAAL,EAAS,eAAT;AACA;AAJoB,EAAtB;AAMA,CATD;;AAWA,mBAAK,2BAAL,EAAkCC,KAAK;AACtC,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;;AAEA,iBAAeE,KAAf,EAAsB;AACrBN,UAAQ,QADa;AAErBQ,WAASrB,EAFY;AAGrBsB,UAAQtB,EAAR,EAAY;AACXC,KAAEsB,EAAF,CAAKvB,EAAL,EAAS,sBAAT;AACA;AALoB,EAAtB;AAOA,CAVD;;AAYA,mBAAK,mCAAL,EAA0CC,KAAK;AAC9C,OAAMkB,QAAQ,EAACF,SAAS,CAAC,sBAAD,CAAV,EAAd;;AAEA,iBAAeE,KAAf,EAAsB;AACrBN,UAAQ,QADa;AAErBQ,WAASrB,EAFY;AAGrBsB,UAAQtB,EAAR,EAAY;AACXC,KAAEsB,EAAF,CAAKvB,EAAL,EAAS,sBAAT;AACA;AALoB,EAAtB;AAOA,CAVD;;AAYA,mBAAK,uCAAL,EAA8CC,KAAK;AAClD,OAAMkB,QAAQ,EAACF,SAAS,CAAC,QAAD,CAAV,EAAd;;AAEA,iBAAeE,KAAf,EAAsB;AACrBN,UAAQ,QADa;AAErBQ,WAASrB,EAFY;AAGrBsB,UAAQtB,EAAR,EAAY;AACXC,KAAEsB,EAAF,CAAKvB,EAAL,EAAS,eAAT;AACA;AALoB,EAAtB;AAOA,CAVD;;AAYA,mBAAK,qCAAL,EAA4CC,KAAK;AAChD,OAAMkB,QAAQ,EAACF,SAAS,CAAC,YAAD,CAAV,EAAd;;AAEA,iBAAeE,KAAf,EAAsB;AACrBN,UAAQ,QADa;AAErBQ,WAASrB,EAFY;AAGrBsB,UAAQtB,EAAR,EAAY;AACXC,KAAEsB,EAAF,CAAKvB,EAAL,EAAS,YAAT;AACA;AALoB,EAAtB;AAOA,CAVD;;AAYA,mBAAK,6CAAL,EAAoDC,KAAK;AACxD,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;AACA,OAAMO,aAAa,EAACnB,KAAK,KAAN,EAAnB;;AAEA,OAAMH,SAAS,gBAAeiB,KAAf,EAAsB;AACpCE,WAASrB,EAD2B;AAEpCsB,YAAU;AACT,UAAOE,UAAP;AACA;AAJmC,EAAtB,CAAf;;AAOAvB,GAAEsB,EAAF,CAAKrB,OAAOG,GAAZ,EAAiB,KAAjB;AACA,CAZD;;AAcA,mBAAK,8BAAL,EAAqCJ,KAAK;AACzC,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;AACA,OAAMf,SAAS,EAAf;;AAEA,iBAAeiB,KAAf,EAAsB;AACrBE,WAASrB,EADY;AAErBsB,UAAQtB,EAAR,EAAY;AACXE,UAAOuB,IAAP,CAAYzB,EAAZ;AACA,OAAIA,OAAO,eAAX,EAA4B;AAC3B,WAAO,EAACiB,SAAS,CAAC,yBAAD,CAAV,EAAP;AACA;AACD,OAAIjB,OAAO,yBAAX,EAAsC;AACrC,WAAO,EAACK,KAAK,KAAN,EAAP;AACA;AACD;AAVoB,EAAtB;;AAaAJ,GAAEE,SAAF,CAAYD,MAAZ,EAAoB,CAAC,eAAD,EAAkB,yBAAlB,CAApB;AACA,CAlBD;;AAoBA,mBAAK,6BAAL,EAAoCD,KAAK;AACxC,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;AACA,OAAMf,SAAS,EAAf;;AAEA,iBAAeiB,KAAf,EAAsB;AACrBN,UAAQ,QADa;AAErBQ,WAASrB,EAFY;AAGrBsB,UAAQtB,EAAR,EAAY;AACXE,UAAOuB,IAAP,CAAYzB,EAAZ;AACA,OAAIA,OAAO,sBAAX,EAAmC;AAClC,WAAO,EAACiB,SAAS,CAAC,yBAAD,CAAV,EAAP;AACA;AACD,OAAIjB,OAAO,gCAAX,EAA6C;AAC5C,WAAO,EAACK,KAAK,KAAN,EAAP;AACA;AACD;AAXoB,EAAtB;;AAcAJ,GAAEE,SAAF,CAAYD,MAAZ,EAAoB,CACnB,sBADmB,EAEnB,gCAFmB,CAApB;AAIA,CAtBD;;AAwBA,mBAAK,iCAAL,EAAwCD,KAAK;AAC5C,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;;AAEA,OAAMf,SAAS,gBAAeiB,KAAf,EAAsB;AACpCE,WAASrB,EAD2B;AAEpCsB,UAAQtB,EAAR,EAAY;AACX,OAAIA,OAAO,eAAX,EAA4B;AAC3B,WAAO,EAACiB,SAAS,CAAC,yBAAD,CAAV,EAAuCZ,KAAK,KAA5C,EAAP;AACA;AACD,OAAIL,OAAO,yBAAX,EAAsC;AACrC,WAAO,EAAC0B,KAAK,KAAN,EAAP;AACA;AACD;AATmC,EAAtB,CAAf;;AAYA,OAAMtB,WAAW;AAChBa,WAAS,CAAC,eAAD,CADO;AAEhBZ,OAAK,KAFW;AAGhBqB,OAAK;AAHW,EAAjB;;AAMAzB,GAAEE,SAAF,CAAYD,MAAZ,EAAoBE,QAApB;AACA,CAtBD;;AAwBA,mBAAK,8CAAL,EAAqDH,KAAK;AACzD,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;;AAEA,OAAMf,SAAS,gBAAeiB,KAAf,EAAsB;AACpCE,WAASrB,EAD2B;AAEpCsB,UAAQtB,EAAR,EAAY;AACX,OAAIA,OAAO,eAAX,EAA4B;AAC3B,WAAO;AACNiB,cAAS,CAAC,yBAAD,CADH;AAENU,YAAO,EAACC,MAAM,CAAC,MAAD,EAAS,KAAT,CAAP;AAFD,KAAP;AAIA;AACD,OAAI5B,OAAO,yBAAX,EAAsC;AACrC,WAAO,EAAC2B,OAAO,EAACC,MAAM,CAAC,KAAD,EAAQ,OAAR,EAAiB,MAAjB,CAAP,EAAR,EAAP;AACA;AACD;AAZmC,EAAtB,CAAf;;AAeA,OAAMxB,WAAW;AAChBa,WAAS,CAAC,eAAD,CADO;AAEhBU,SAAO;AACNC,SAAM,CAAC,MAAD,EAAS,KAAT;AADA;AAFS,EAAjB;;AAOA3B,GAAEE,SAAF,CAAYD,MAAZ,EAAoBE,QAApB;AACA,CA1BD;;AA4BA,mBAAK,2CAAL,EAAkDH,KAAK;AACtD,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAA6BY,MAAM,MAAnC,EAAd;;AAEA,OAAM3B,SAAS,gBAAeiB,KAAf,EAAsB;AACpCE,WAASrB,EAD2B;AAEpCsB,UAAQtB,EAAR,EAAY;AACX,OAAIA,OAAO,eAAX,EAA4B;AAC3B,WAAO,EAACiB,SAAS,CAAC,yBAAD,CAAV,EAAuCY,MAAM7B,EAA7C,EAAiD8B,KAAK9B,EAAtD,EAAP;AACA;AACD,OAAIA,OAAO,yBAAX,EAAsC;AACrC,WAAO;AACNiB,cAAS,CAAC,gCAAD,CADH;AAENY,WAAM7B,EAFA;AAGN8B,UAAK9B,EAHC;AAIN+B,UAAK/B;AAJC,KAAP;AAMA;AACD,OAAIA,OAAO,gCAAX,EAA6C;AAC5C,WAAO,EAAC6B,MAAM7B,EAAP,EAAW8B,KAAK9B,EAAhB,EAAoB+B,KAAK/B,EAAzB,EAA6BgC,OAAOhC,EAApC,EAAP;AACA;AACD;AAjBmC,EAAtB,CAAf;;AAoBA,OAAMI,WAAW;AAChBa,WAAS,CAAC,eAAD,CADO;AAEhBY,QAAM,MAFU;AAGhBC,OAAK,eAHW;AAIhBC,OAAK,yBAJW;AAKhBC,SAAO;AALS,EAAjB;;AAQA/B,GAAEE,SAAF,CAAYD,MAAZ,EAAoBE,QAApB;AACA,CAhCD;;AAkCA,mBAAK,+DAAL,EAAsEH,KAAK;AAC1E,OAAMkB,QAAQ,EAACF,SAAS,CAAC,eAAD,CAAV,EAAd;;AAEA,OAAMf,SAAS,gBAAeiB,KAAf,EAAsB;AACpCN,UAAQ,QAD4B;AAEpCQ,UAAQrB,EAAR,EAAY;AACX,OAAIA,OAAO,kDAAX,EAA+D;AAC9D,WAAO,kDAAP;AACA;AACD,SAAM,IAAIiC,KAAJ,CAAW,2BAA0BjC,EAAG,GAAxC,CAAN;AACA,GAPmC;AAQpCsB,UAAQtB,EAAR,EAAY;AACX,OAAIA,OAAO,kDAAX,EAA+D;AAC9D,WAAO;AACN2B,YAAO;AACNO,gBAAU;AADJ;AADD,KAAP;AAKA;AACD;AAhBmC,EAAtB,CAAf;;AAmBAjC,GAAEE,SAAF,CAAYD,MAAZ,EAAoB;AACnBe,WAAS,CAAC,eAAD,CADU;AAEnBU,SAAO;AACNO,aAAU;AADJ;AAFY,EAApB;AAMA,CA5BD","file":"index.test.js","sourcesContent":["import test from 'ava';\nimport execa from 'execa';\nimport {fix} from '@commitlint/test';\nimport * as sander from '@marionebl/sander';\nimport resolveExtends from '.';\n\nconst id = id => id;\n\ntest('returns empty object when called without params', t => {\n\tconst actual = resolveExtends();\n\tt.deepEqual(actual, {});\n});\n\ntest('returns an equivalent object as passed in', t => {\n\tconst expected = {foo: 'bar'};\n\tconst actual = resolveExtends(expected);\n\tt.deepEqual(actual, expected);\n});\n\ntest.serial('falls back to global install', async t => {\n\tconst prev = process.env.PREFIX;\n\n\tconst cwd = await fix.bootstrap('fixtures/global-install');\n\tconst prefix = `${cwd}/commitlint-npm-packages`;\n\n\tconst npm = args => execa('npm', args, {cwd});\n\n\tawait sander.mkdir(cwd, 'commitlint-npm-packages');\n\n\tprocess.env.PREFIX = prefix;\n\n\tawait npm([\n\t\t'install',\n\t\t'--global',\n\t\t'@commitlint/config-angular',\n\t\t'--prefix',\n\t\tprefix\n\t]);\n\n\tconst expected = {extends: ['@commitlint/config-angular']};\n\tt.notThrows(() => resolveExtends(expected));\n\n\tprocess.env.PREFIX = prev;\n});\n\ntest.serial('fails for missing extends', async t => {\n\tconst prev = process.env.PREFIX;\n\n\tconst cwd = await fix.bootstrap('fixtures/missing-install');\n\tconst prefix = `${cwd}/commitlint-npm-packages`;\n\n\tprocess.env.PREFIX = prefix;\n\n\tconst input = {extends: ['@commitlint/foo-bar']};\n\n\tt.throws(\n\t\t() => resolveExtends(input, {cwd}),\n\t\t/Cannot find module \"@commitlint\\/foo-bar\" from/\n\t);\n\n\tprocess.env.PREFIX = prev;\n});\n\ntest('uses empty prefix by default', t => {\n\tconst input = {extends: ['extender-name']};\n\n\tresolveExtends(input, {\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tt.is(id, 'extender-name');\n\t\t}\n\t});\n});\n\ntest('uses prefix as configured', t => {\n\tconst input = {extends: ['extender-name']};\n\n\tresolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tt.is(id, 'prefix-extender-name');\n\t\t}\n\t});\n});\n\ntest('ignores prefix for scoped extends', t => {\n\tconst input = {extends: ['@scope/extender-name']};\n\n\tresolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tt.is(id, '@scope/extender-name');\n\t\t}\n\t});\n});\n\ntest('adds prefix as suffix for scopes only', t => {\n\tconst input = {extends: ['@scope']};\n\n\tresolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tt.is(id, '@scope/prefix');\n\t\t}\n\t});\n});\n\ntest('ignores prefix for relative extends', t => {\n\tconst input = {extends: ['./extender']};\n\n\tresolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tt.is(id, './extender');\n\t\t}\n\t});\n});\n\ntest('propagates return value of require function', t => {\n\tconst input = {extends: ['extender-name']};\n\tconst propagated = {foo: 'bar'};\n\n\tconst actual = resolveExtends(input, {\n\t\tresolve: id,\n\t\trequire() {\n\t\t\treturn propagated;\n\t\t}\n\t});\n\n\tt.is(actual.foo, 'bar');\n});\n\ntest('resolves extends recursively', t => {\n\tconst input = {extends: ['extender-name']};\n\tconst actual = [];\n\n\tresolveExtends(input, {\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tactual.push(id);\n\t\t\tif (id === 'extender-name') {\n\t\t\t\treturn {extends: ['recursive-extender-name']};\n\t\t\t}\n\t\t\tif (id === 'recursive-extender-name') {\n\t\t\t\treturn {foo: 'bar'};\n\t\t\t}\n\t\t}\n\t});\n\n\tt.deepEqual(actual, ['extender-name', 'recursive-extender-name']);\n});\n\ntest('uses prefix key recursively', t => {\n\tconst input = {extends: ['extender-name']};\n\tconst actual = [];\n\n\tresolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tactual.push(id);\n\t\t\tif (id === 'prefix-extender-name') {\n\t\t\t\treturn {extends: ['recursive-extender-name']};\n\t\t\t}\n\t\t\tif (id === 'prefix-recursive-extender-name') {\n\t\t\t\treturn {foo: 'bar'};\n\t\t\t}\n\t\t}\n\t});\n\n\tt.deepEqual(actual, [\n\t\t'prefix-extender-name',\n\t\t'prefix-recursive-extender-name'\n\t]);\n});\n\ntest('propagates contents recursively', t => {\n\tconst input = {extends: ['extender-name']};\n\n\tconst actual = resolveExtends(input, {\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tif (id === 'extender-name') {\n\t\t\t\treturn {extends: ['recursive-extender-name'], foo: 'bar'};\n\t\t\t}\n\t\t\tif (id === 'recursive-extender-name') {\n\t\t\t\treturn {baz: 'bar'};\n\t\t\t}\n\t\t}\n\t});\n\n\tconst expected = {\n\t\textends: ['extender-name'],\n\t\tfoo: 'bar',\n\t\tbaz: 'bar'\n\t};\n\n\tt.deepEqual(actual, expected);\n});\n\ntest('propagates contents recursively with overlap', t => {\n\tconst input = {extends: ['extender-name']};\n\n\tconst actual = resolveExtends(input, {\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tif (id === 'extender-name') {\n\t\t\t\treturn {\n\t\t\t\t\textends: ['recursive-extender-name'],\n\t\t\t\t\trules: {rule: ['zero', 'one']}\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (id === 'recursive-extender-name') {\n\t\t\t\treturn {rules: {rule: ['two', 'three', 'four']}};\n\t\t\t}\n\t\t}\n\t});\n\n\tconst expected = {\n\t\textends: ['extender-name'],\n\t\trules: {\n\t\t\trule: ['zero', 'one']\n\t\t}\n\t};\n\n\tt.deepEqual(actual, expected);\n});\n\ntest('extending contents should take precedence', t => {\n\tconst input = {extends: ['extender-name'], zero: 'root'};\n\n\tconst actual = resolveExtends(input, {\n\t\tresolve: id,\n\t\trequire(id) {\n\t\t\tif (id === 'extender-name') {\n\t\t\t\treturn {extends: ['recursive-extender-name'], zero: id, one: id};\n\t\t\t}\n\t\t\tif (id === 'recursive-extender-name') {\n\t\t\t\treturn {\n\t\t\t\t\textends: ['second-recursive-extender-name'],\n\t\t\t\t\tzero: id,\n\t\t\t\t\tone: id,\n\t\t\t\t\ttwo: id\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (id === 'second-recursive-extender-name') {\n\t\t\t\treturn {zero: id, one: id, two: id, three: id};\n\t\t\t}\n\t\t}\n\t});\n\n\tconst expected = {\n\t\textends: ['extender-name'],\n\t\tzero: 'root',\n\t\tone: 'extender-name',\n\t\ttwo: 'recursive-extender-name',\n\t\tthree: 'second-recursive-extender-name'\n\t};\n\n\tt.deepEqual(actual, expected);\n});\n\ntest('should fall back to conventional-changelog-lint-config prefix', t => {\n\tconst input = {extends: ['extender-name']};\n\n\tconst actual = resolveExtends(input, {\n\t\tprefix: 'prefix',\n\t\tresolve(id) {\n\t\t\tif (id === 'conventional-changelog-lint-config-extender-name') {\n\t\t\t\treturn 'conventional-changelog-lint-config-extender-name';\n\t\t\t}\n\t\t\tthrow new Error(`Could not find module \"*${id}\"`);\n\t\t},\n\t\trequire(id) {\n\t\t\tif (id === 'conventional-changelog-lint-config-extender-name') {\n\t\t\t\treturn {\n\t\t\t\t\trules: {\n\t\t\t\t\t\tfallback: true\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t});\n\n\tt.deepEqual(actual, {\n\t\textends: ['extender-name'],\n\t\trules: {\n\t\t\tfallback: true\n\t\t}\n\t});\n});\n"]}